<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Zoom 简单分析 - avcatshy</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="avcatshy"><meta name="msapplication-TileImage" content="https://avatars.githubusercontent.com/u/20829507?s=60&amp;v=4"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="avcatshy"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="最近闲来无事儿，找个app学习学习想起之前某个机缘巧合的情况下，与zoom的大佬们有过简单的交流。就它吧！ Zoom Version: iOS 5.6.1(172)"><meta property="og:type" content="blog"><meta property="og:title" content="Zoom 简单分析"><meta property="og:url" content="https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/"><meta property="og:site_name" content="avcatshy"><meta property="og:description" content="最近闲来无事儿，找个app学习学习想起之前某个机缘巧合的情况下，与zoom的大佬们有过简单的交流。就它吧！ Zoom Version: iOS 5.6.1(172)"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/repackage_check.png"><meta property="og:image" content="https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/fix_mainThreadChecker.png"><meta property="og:image" content="https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/zoom_ca_check.png"><meta property="og:image" content="https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/ca_check_wireshark.png"><meta property="og:image" content="https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/ida_openssl_str.png"><meta property="og:image" content="http://www.ruanyifeng.com/blogimg/asset/2014/bg2014092003.png"><meta property="og:image" content="https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/tls.png"><meta property="og:image" content="https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/login_zoom_com.png"><meta property="og:image" content="https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/login_zoom_us.png"><meta property="og:image" content="https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/ZM-SESS-KEY.jpg"><meta property="og:image" content="https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/ecp_passwd_ida.png"><meta property="og:image" content="https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/sha256_aes128cbc_b64.jpg"><meta property="article:published_time" content="2021-07-03T15:43:18.545Z"><meta property="article:modified_time" content="2021-07-03T16:46:40.529Z"><meta property="article:author" content="vlinkstone"><meta property="article:tag" content="iOS"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="./repackage_check.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/"},"headline":"Zoom 简单分析","image":["https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/repackage_check.png","https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/fix_mainThreadChecker.png","https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/zoom_ca_check.png","https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/ca_check_wireshark.png","https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/ida_openssl_str.png","http://www.ruanyifeng.com/blogimg/asset/2014/bg2014092003.png","https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/tls.png","https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/login_zoom_com.png","https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/login_zoom_us.png","https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/ZM-SESS-KEY.jpg","https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/ecp_passwd_ida.png","https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/sha256_aes128cbc_b64.jpg"],"datePublished":"2021-07-03T15:43:18.545Z","dateModified":"2021-07-03T16:46:40.529Z","author":{"@type":"Person","name":"vlinkstone"},"publisher":{"@type":"Organization","name":"avcatshy","logo":{"@type":"ImageObject","url":"https://avatars.githubusercontent.com/u/20829507?s=60&v=4"}},"description":"最近闲来无事儿，找个app学习学习想起之前某个机缘巧合的情况下，与zoom的大佬们有过简单的交流。就它吧！ Zoom Version: iOS 5.6.1(172)"}</script><link rel="canonical" href="https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/"><link rel="icon" href="https://avatars.githubusercontent.com/u/20829507?s=60&amp;v=4"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://avatars.githubusercontent.com/u/20829507?s=60&amp;v=4" alt="avcatshy" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/2021/07/03/about/">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/avcatshy"><i class="fab fa-github"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-07-03T15:43:18.545Z" title="7/3/2021, 8:43:18 AM">2021-07-03</time>发表</span><span class="level-item"><time dateTime="2021-07-03T16:46:40.529Z" title="7/3/2021, 9:46:40 AM">2021-07-03</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/iOS/">iOS</a></span><span class="level-item">27 分钟读完 (大约4018个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Zoom 简单分析</h1><div class="content"><p>最近闲来无事儿，找个app学习学习<br>想起之前某个机缘巧合的情况下，与zoom的大佬们有过简单的交流。就它吧！<br> Zoom Version: iOS 5.6.1(172)<br> <span id="more"></span></p>
<h2 id="0x00-去除重打包检测相关"><a href="#0x00-去除重打包检测相关" class="headerlink" title="0x00  去除重打包检测相关"></a>0x00  去除重打包检测相关</h2><p>直接使用MonkeyDev 重打包，提示‘LLVM Profile Error: “default.profraw”‘并直接退出</p>
<p>直接丢进ida中看，</p>
<p><img src="./repackage_check.png"></p>
<p>有检测embedded.mobileprovision 文件，同时瞄到ptrace检测调试， 伪代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">v4 = objc_msgSend(&amp;OBJC_CLASS___NSBundle, <span class="string">&quot;mainBundle&quot;</span>);</span><br><span class="line">v5 = objc_msgSend(v4, <span class="string">&quot;pathForResource:ofType:&quot;</span>, <span class="built_in">CFSTR</span>(<span class="string">&quot;embedded&quot;</span>), <span class="built_in">CFSTR</span>(<span class="string">&quot;mobileprovision&quot;</span>));</span><br><span class="line"><span class="keyword">if</span> ( objc_msgSend(v5, <span class="string">&quot;length&quot;</span>) )</span><br><span class="line">  exit(<span class="number">0</span>);</span><br><span class="line">v6 = (__int64)dlopen(<span class="number">0</span>LL, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">if</span> ( v6 )</span><br><span class="line">&#123;</span><br><span class="line">  v14 = (<span class="keyword">void</span> *)v6;</span><br><span class="line">  v15 = dlsym((<span class="keyword">void</span> *)v6, <span class="string">&quot;ptrace&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v15 )</span><br><span class="line">    ((<span class="keyword">void</span> (__fastcall *)(<span class="keyword">signed</span> __int64, _QWORD, _QWORD, _QWORD))v15)(<span class="number">31</span>LL, <span class="number">0</span>LL, <span class="number">0</span>LL, <span class="number">0</span>LL);</span><br><span class="line">  v6 = dlclose(v14);</span><br><span class="line">&#125;</span><br><span class="line">v16 = sub_1000356A0(v6, v7, v8, v9, v10, v11, v12, v13, v22, v23, v24);</span><br></pre></td></tr></table></figure>

<p>绕过也很简单：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">%hook <span class="built_in">NSBundle</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)pathForResource:(<span class="built_in">NSString</span> *)name</span><br><span class="line">                       ofType:(<span class="built_in">NSString</span> *)ext</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>([name isEqualToString:<span class="string">@&quot;embedded&quot;</span>] &amp;&amp; [ext isEqualToString:<span class="string">@&quot;mobileprovision&quot;</span>])&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;find embedded.mobileprovision...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> %orig();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">%end</span><br></pre></td></tr></table></figure>

<p>绕过以后却一直提示这个</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">Main Thread Checker: UI API called on a background thread: -[<span class="built_in">UIApplication</span> applicationState]</span><br><span class="line">PID: <span class="number">1829</span>, TID: <span class="number">61332</span>, Thread name: com.apple.CoreMotion.MotionThread, Queue name: com.apple.root.default-qos.overcommit, QoS: <span class="number">0</span></span><br><span class="line">Backtrace:</span><br><span class="line"><span class="number">4</span>   libobjc.A.dylib                     <span class="number">0x0000000224f1b6f4</span> &lt;redacted&gt; + <span class="number">56</span></span><br><span class="line"><span class="number">5</span>   CoreMotion                          <span class="number">0x000000022b695d9c</span> CoreMotion + <span class="number">294300</span></span><br><span class="line"><span class="number">6</span>   CoreMotion                          <span class="number">0x000000022b6962cc</span> CoreMotion + <span class="number">295628</span></span><br><span class="line"><span class="number">7</span>   CoreMotion                          <span class="number">0x000000022b6961dc</span> CoreMotion + <span class="number">295388</span></span><br><span class="line"><span class="number">8</span>   CoreMotion                          <span class="number">0x000000022b6c401c</span> CoreMotion + <span class="number">483356</span></span><br><span class="line"><span class="number">9</span>   CoreMotion                          <span class="number">0x000000022b6c4060</span> CoreMotion + <span class="number">483424</span></span><br><span class="line"><span class="number">10</span>  CoreFoundation                      <span class="number">0x0000000225caa27c</span> &lt;redacted&gt; + <span class="number">28</span></span><br><span class="line"><span class="number">11</span>  CoreFoundation                      <span class="number">0x0000000225ca9b64</span> &lt;redacted&gt; + <span class="number">276</span></span><br><span class="line"><span class="number">12</span>  CoreFoundation                      <span class="number">0x0000000225ca4e58</span> &lt;redacted&gt; + <span class="number">2276</span></span><br><span class="line"><span class="number">13</span>  CoreFoundation                      <span class="number">0x0000000225ca4254</span> <span class="built_in">CFRunLoopRunSpecific</span> + <span class="number">452</span></span><br><span class="line"><span class="number">14</span>  CoreFoundation                      <span class="number">0x0000000225ca4f88</span> <span class="built_in">CFRunLoopRun</span> + <span class="number">84</span></span><br><span class="line"><span class="number">15</span>  CoreMotion                          <span class="number">0x000000022b6c39f4</span> CoreMotion + <span class="number">481780</span></span><br><span class="line"><span class="number">16</span>  libsystem_pthread.dylib             <span class="number">0x0000000225922908</span> &lt;redacted&gt; + <span class="number">132</span></span><br><span class="line"><span class="number">17</span>  libsystem_pthread.dylib             <span class="number">0x0000000225922864</span> _pthread_start + <span class="number">48</span></span><br><span class="line"><span class="number">18</span>  libsystem_pthread.dylib             <span class="number">0x000000022592adcc</span> thread_start + <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------</span></span><br><span class="line"><span class="number">2021</span><span class="number">-05</span><span class="number">-14</span> <span class="number">21</span>:<span class="number">17</span>:<span class="number">42.684256</span>+<span class="number">0800</span> Zoom[<span class="number">2148</span>:<span class="number">69541</span>] old data has cpoied done</span><br><span class="line">=================================================================</span><br><span class="line">Main Thread Checker: UI API called on a background thread: -[<span class="built_in">UIApplication</span> applicationState]</span><br><span class="line">PID: <span class="number">2148</span>, TID: <span class="number">69718</span>, Thread name: com.apple.CoreMotion.MotionThread, Queue name: com.apple.root.default-qos.overcommit, QoS: <span class="number">0</span></span><br><span class="line">Backtrace:</span><br><span class="line"><span class="number">4</span>   libobjc.A.dylib                     <span class="number">0x0000000224f1b6f4</span> &lt;redacted&gt; + <span class="number">56</span></span><br><span class="line"><span class="number">5</span>   CoreMotion                          <span class="number">0x000000022b695d9c</span> CoreMotion + <span class="number">294300</span></span><br><span class="line">...</span><br><span class="line"><span class="number">2021</span><span class="number">-05</span><span class="number">-14</span> <span class="number">21</span>:<span class="number">17</span>:<span class="number">42.964460</span>+<span class="number">0800</span> Zoom[<span class="number">2148</span>:<span class="number">69718</span>] [reports] Main Thread Checker: UI API called on a background thread: -[<span class="built_in">UIApplication</span> applicationState]</span><br><span class="line">PID: <span class="number">2148</span>, TID: <span class="number">69718</span>, Thread name: com.apple.CoreMotion.MotionThread, Queue name: com.apple.root.default-qos.overcommit, QoS: <span class="number">0</span></span><br><span class="line">Backtrace:</span><br><span class="line"><span class="number">4</span>   libobjc.A.dylib                     <span class="number">0x0000000224f1b6f4</span> &lt;redacted&gt; + <span class="number">56</span></span><br><span class="line"><span class="number">5</span>   CoreMotion                          <span class="number">0x000000022b695d9c</span> CoreMotion + <span class="number">294300</span></span><br><span class="line"><span class="number">6</span>   CoreMotion                          <span class="number">0x000000022b6962cc</span> CoreMotion + <span class="number">295628</span></span><br><span class="line">...</span><br><span class="line">(lldb) bt</span><br><span class="line">* thread #<span class="number">20</span>, name = <span class="string">&#x27;com.apple.CoreMotion.MotionThread&#x27;</span>, stop reason = EXC_BAD_ACCESS (code=<span class="number">1</span>, address=<span class="number">0x0</span>)</span><br><span class="line">  * frame #<span class="number">0</span>: <span class="number">0x0000000000000000</span></span><br><span class="line">    frame #<span class="number">1</span>: <span class="number">0x0000000105731a6c</span> libMainThreadChecker.dylib`__ASSERT_API_MUST_BE_CALLED_FROM_MAIN_THREAD_FAILED__ + <span class="number">812</span></span><br><span class="line">    frame #<span class="number">2</span>: <span class="number">0x0000000105731e0c</span> libMainThreadChecker.dylib`checker_c + <span class="number">412</span></span><br><span class="line">    frame #<span class="number">3</span>: <span class="number">0x00000001057316b0</span> libMainThreadChecker.dylib`trampoline_c + <span class="number">76</span></span><br><span class="line">    frame #<span class="number">4</span>: <span class="number">0x00000001056f145c</span> libMainThreadChecker.dylib`handler_start + <span class="number">52</span></span><br><span class="line">    frame #<span class="number">5</span>: <span class="number">0x00000001056fce7c</span> libMainThreadChecker.dylib`__trampolines + <span class="number">47600</span></span><br><span class="line">    frame #<span class="number">6</span>: <span class="number">0x0000000224f1b6f4</span> libobjc.A.dylib`-[<span class="built_in">NSObject</span> performSelector:] + <span class="number">56</span></span><br><span class="line">    frame #<span class="number">7</span>: <span class="number">0x000000022b695d9c</span> CoreMotion`___lldb_unnamed_symbol1461$$CoreMotion + <span class="number">908</span></span><br><span class="line">...</span><br><span class="line">(phone<span class="string">&#x27;s lldb)</span></span><br></pre></td></tr></table></figure>

<p>对于强迫症来说可太难顶了，很快啊，我啪就给丫关了：</p>
<p><img src="./fix_mainThreadChecker.png"></p>
<h3 id="对抗"><a href="#对抗" class="headerlink" title="对抗"></a>对抗</h3><ol>
<li>检测不放在start中，可以多点多次检测</li>
<li>检测重打包(检测调试状态 也类似)</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//简单版本：</span></span><br><span class="line">__attribute__((constructor)) <span class="keyword">static</span> <span class="keyword">void</span> (*__result)();</span><br><span class="line"></span><br><span class="line"><span class="comment">//     垃圾指令 </span></span><br><span class="line"><span class="comment">//     ...</span></span><br><span class="line"><span class="comment">//    __asm__(&quot;mov x0, #0\\n&quot;</span></span><br><span class="line"><span class="comment">//            &quot;mov x1, #0\\n&quot;</span></span><br><span class="line"><span class="comment">//            &quot;mov sp, x1\\n&quot;</span></span><br><span class="line"><span class="comment">//            &quot;mov x29, x1\\n&quot;</span></span><br><span class="line"><span class="comment">//            &quot;mov x30, x1\\n&quot;</span></span><br><span class="line"><span class="comment">//            &quot;mov w16, #1\\n&quot;</span></span><br><span class="line"><span class="comment">//            &quot;svc #0x80\\n&quot;);</span></span><br><span class="line"><span class="comment">//      也可再加一些垃圾指令</span></span><br><span class="line"><span class="comment">// char asd[]=&quot;\\xE0\\x03\\x08\\xAA\\x00\\x10\\x80\\xD2\\x01\\x10\\x80\\xD2\\x00\\x00\\x80\\xd2\\x01\\x00\\x80\\xd2\\x3f\\x00\\x00\\x91\\xfd\\x03\\x01\\xaa\\xfe\\x03\\x01\\xaa\\x30\\x00\\x80\\x52\\x01\\x10\\x00\\xd4&quot;;</span></span><br><span class="line"><span class="keyword">char</span> dsa[]=<span class="string">&quot;\\xB5\\x56\\x5D\\xFF\\x55\\x45\\xD5\\x87\\x54\\x45\\xD5\\x87\\x55\\x55\\xD5\\x87\\x54\\x55\\xD5\\x87\\x6A\\x55\\x55\\xC4\\xA8\\x56\\x54\\xFF\\xAB\\x56\\x54\\xFF\\x65\\x55\\xD5\\x07\\x54\\x45\\x55\\x81\\x55&quot;</span>;</span><br><span class="line"></span><br><span class="line">__attribute__((constructor)) <span class="keyword">static</span> <span class="keyword">void</span>* __objc_alloc()&#123;</span><br><span class="line">    <span class="keyword">void</span>* ptr=mmap(<span class="number">0</span>, <span class="number">0x100</span>, PROT_WRITE | PROT_READ, MAP_ANON | MAP_PRIVATE , <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (ptr == MAP_FAILED) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    memcpy(ptr, dsa, (<span class="keyword">sizeof</span>(dsa)&lt;<span class="number">0x100</span>?<span class="keyword">sizeof</span>(dsa):<span class="number">0x99</span>));</span><br><span class="line">    <span class="keyword">char</span>* pptr=(<span class="keyword">char</span>* )ptr;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;(<span class="keyword">sizeof</span>(dsa)&lt;<span class="number">0x100</span>?<span class="keyword">sizeof</span>(dsa):<span class="number">0x99</span>); k++) &#123;</span><br><span class="line">        pptr[k]=pptr[k]^<span class="number">0x55</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> i=mprotect(ptr, <span class="number">0x100</span>, PROT_EXEC);</span><br><span class="line">    <span class="keyword">if</span> (i!=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    __result=ptr;</span><br><span class="line">    <span class="keyword">return</span> __result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__((constructor)) <span class="keyword">static</span> <span class="keyword">void</span> _stack_chk_success()&#123;</span><br><span class="line">    __objc_alloc();</span><br><span class="line">    <span class="built_in">NSString</span>* BASE_PATH = [[<span class="built_in">NSBundle</span> mainBundle] bundlePath];</span><br><span class="line">    <span class="built_in">NSFileManager</span> *myFileManager = [<span class="built_in">NSFileManager</span> defaultManager];</span><br><span class="line">    <span class="built_in">NSDirectoryEnumerator</span> *myDirectoryEnumerator = [myFileManager enumeratorAtPath:BASE_PATH];</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *path <span class="keyword">in</span> myDirectoryEnumerator.allObjects) &#123;</span><br><span class="line">        <span class="built_in">NSData</span> *data = [path dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        <span class="built_in">NSString</span> *base64String = [data base64EncodedStringWithOptions:<span class="built_in">NSDataBase64EncodingEndLineWithLineFeed</span>];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> 1</span></span><br><span class="line">        <span class="comment">//embedded.mobileconfig</span></span><br><span class="line">        <span class="keyword">if</span> ([base64String isEqualToString:<span class="string">@&quot;ZW1iZWRkZWQubW9iaWxlcHJvdmlzaW9u&quot;</span>])&#123;</span><br><span class="line">          <span class="comment">//  __result();</span></span><br><span class="line">					pthread_t thread;</span><br><span class="line">          pthread_create(&amp;thread, <span class="literal">NULL</span>, __result, <span class="literal">NULL</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li> 最近看到一个开源库做安全性检测的<a target="_blank" rel="noopener" href="https://github.com/securing/IOSSecuritySuite%EF%BC%8C">https://github.com/securing/IOSSecuritySuite，</a> 粗略看了下检测的还算OK，做开发的朋友们有没有用过的    &lt;wink～&gt;</li>
</ol>
<p>ETC：</p>
<p>其实除了重打包检测和反调试以外，还有越狱检测，但是越狱检测可以直接使用现有的工具（比如Liberty…）直接绕过，这里就不多说了。</p>
<h2 id="0x01-抓包"><a href="#0x01-抓包" class="headerlink" title="0x01 抓包"></a>0x01 抓包</h2><p>解决了相关检测问题后，就可以直接调试应用了。既然要看登陆过程，那么抓包就是不可避免的一个步骤。先尝试了直接使用frida hook ssl read/write ，结果什么也没有，就很郁闷。尝试使用Charles设置代理抓包，结果发现：</p>
<p><img src="./zoom_ca_check.png"></p>
<p>原来是存在证书校验，具体可以使用wireshark查看：</p>
<p><img src="./ca_check_wireshark.png"></p>
<p>可以看出是在server hello 完成后客户端检测到证书不匹配，既然问题出在客户端，那么就还是好解决的，拿现成的工具比如ssl kill switch直接干掉就完了，完事收工。</p>
<p>哈哈哈哈，当然不可能这么简单，不然还写什么写。用了ssl kill switch 后也是不起作用的，然后又试了自己hook NSURLSession、Security等系列函数中的检测部分，结果也还是不行，我emo了家人们，多吓人呐。当时在这里卡了挺久，没想到什么原因，更别提解决办法了，就想着先用ida搜搜关键字看能不能找到些线索。</p>
<h3 id="1-明确无法抓包的原因"><a href="#1-明确无法抓包的原因" class="headerlink" title="1. 明确无法抓包的原因"></a>1. 明确无法抓包的原因</h3><p>在浏览字符串的时候看到了openssl相关关键字，然后搜了下，还挺多：</p>
<p><img src="./ida_openssl_str.png"></p>
<p>瞬间就有了点什么想法，立马扭头跟大哥JKSun请教一番。该说不说，大哥就是大哥，很快就帮我确认了我的想法，这丫静态编译的openssl进去，并非使用系统库，难怪各种hook都不起作用。同时还看到在项目目录下有curl7.74.0相关代码目录，这里留意下暂且不表。</p>
<h3 id="2-解决方式"><a href="#2-解决方式" class="headerlink" title="2. 解决方式"></a>2. 解决方式</h3><h4 id="2-1-一些奇妙的知识"><a href="#2-1-一些奇妙的知识" class="headerlink" title="2.1 一些奇妙的知识"></a>2.1 一些奇妙的知识</h4><p>HTTPS经由HTTP进行通信，但利用SSL/TLS来加密数据包。这里https的原理部分不打算细讲，简单说说SSL的握手部分，搞明白这部分是我们后面操作的基础。闲话不多说，先看张图：</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2014/bg2014092003.png" alt="http://www.ruanyifeng.com/blogimg/asset/2014/bg2014092003.png"></p>
<p>这张图讲解了tls的握手流程，我们这里需要注意几点：</p>
<ol>
<li>client向server端发送ClientHello数据包（包含支持的ssl版本等基础信息，以及一个随机数 random_num_client）</li>
<li>server端在收到ClientHello后会向client发送ServerHello数据包（包含最终使用ssl配置等相关信息、server的publicKey和证书，以及一个随机数 random_num_server（如果设置了双向校验相关选项，这里server还会向client发送ClientCertificateRequest，后续会校验））</li>
<li>client收到ServerHello相关信息后，会使用RSA或DH算法生成第三个随机数（称之为Premaster Secret）然后使用server的publicKey加密后发送给server端</li>
<li>client和server都知道这三个随机数，且PreMasterSecret 在传输过程中是加密的。利用这三个随机数生成MasterSecret进而生成后续数据传输中使用的SessionKey，我们用下面这张图来表示</li>
</ol>
<p><img src="./tls.png"></p>
<p>想要解开https数据包，我们就得获得这个握手过程中的PreMasterSecret 或者是MasterSecret。</p>
<p>在握手过程中，除了交换random 生成（Pre）MasterSecret 之外，还有个重要的任务就是进行身份认证，也就是我们常说的证书校验。身份认证也分两种：单向认证和双向认证，一般情况下只需要进行单向认证也就是client确认server的身份即可，对于一些重要的业务场景则需要client和server互相确认身份。</p>
<h4 id="2-2-具体方式"><a href="#2-2-具体方式" class="headerlink" title="2.2 具体方式"></a>2.2 具体方式</h4><p>自己编译一份对应版本的openssl库，通过特征比对找到对应函数，尔后便可以解决抓包。机灵的小伙伴可以使用ida的sdk生成对应的sig文件，然后就可以直接识别了，我当时好像不太聪明的样子一个一个手动找的特征QaQ</p>
<p>结合上面奇妙的知识，我们可以用的方法就多，具体操作有：</p>
<ul>
<li><p>通过hook获取master key 可以解开https的加密数据 –&gt; 可以直接使用wireshark 抓包</p>
</li>
<li><p>绕过证书校验部分， 用burp等工具可以直接抓包       –&gt; 通过burp等代理抓包工具抓包</p>
</li>
<li><p>hook ssl read/write 直接获取通讯数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//0x01  get client_random, master_secret</span></span><br><span class="line"><span class="keyword">var</span> client</span><br><span class="line"><span class="keyword">var</span> master</span><br><span class="line"><span class="comment">// zoom_561_172</span></span><br><span class="line"><span class="comment">// 0xB945B8</span></span><br><span class="line"><span class="comment">// 先通过0xB61518  tls1_PRF 确定版本相关信息，再直接hook 获取master scret</span></span><br><span class="line">Interceptor.attach(base.add(<span class="number">0xB6176C</span>), &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> oob = Memory.readU64(args[<span class="number">0</span>].add(<span class="number">0xa8</span>))</span><br><span class="line">        client = oob.add(<span class="number">0xb8</span>)</span><br><span class="line">        master = args[<span class="number">1</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;CLIENT_RANDOM&quot;</span>, arraybuffer2hexstr(Memory.readByteArray(ptr(client), <span class="number">32</span>)), arraybuffer2hexstr(Memory.readByteArray(ptr(master), <span class="number">48</span>)))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//0x02 bypass 证书校验</span></span><br><span class="line"><span class="comment">//0x100B39B4C --  ssl_verify_cert_chain </span></span><br><span class="line">Interceptor.attach(base.add(<span class="number">0xB39B4C</span>), &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(Thread.backtrace(<span class="built_in">this</span>.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join(<span class="string">&#x27;\n&#x27;</span>) + <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;call ssl_verify_cert_chain&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;ret:&quot;</span>, retval)</span><br><span class="line">        retval.replace(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ssl_session_get_id_func</span>(<span class="params">ssl, len</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len) &#123;</span><br><span class="line">        <span class="keyword">var</span> lenn = Memory.readU64(ptr(ssl.add(<span class="number">0x150</span>)))</span><br><span class="line">        Memory.writeU32(len, lenn)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ptr(ssl.add(<span class="number">0x158</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ; SSL_SESSION *__cdecl SSL_get_session(const SSL *ssl)</span></span><br><span class="line"><span class="comment">// __text:0000000000025E64                                   EXPORT _SSL_get_session</span></span><br><span class="line"><span class="comment">// __text:0000000000025E64                   _SSL_get_session                        ; CODE XREF: _SSL_copy_session_id+18↑p</span></span><br><span class="line"><span class="comment">// __text:0000000000025E64                                                           ; _ssl_validate_ct+D4↑p ...</span></span><br><span class="line"><span class="comment">// __text:0000000000025E64 00 88 42 F9                       LDR             X0, [X0,#0x510]</span></span><br><span class="line"><span class="comment">// __text:0000000000025E68 C0 03 5F D6                       RET</span></span><br><span class="line"><span class="comment">// __text:0000000000025E68                   ; End of function _SSL_get_session</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ssl_get_session_func</span>(<span class="params">ssl</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Memory.readU64(ssl.add(<span class="number">0x510</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSslSessionId</span>(<span class="params">ssl</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> session = ssl_get_session_func(ssl);</span><br><span class="line">    <span class="keyword">if</span> (session == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> len = Memory.alloc(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">var</span> p = ssl_session_get_id_func(session, len);</span><br><span class="line">    len = Memory.readU32(len);</span><br><span class="line">    <span class="keyword">var</span> session_id = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        session_id += (<span class="string">&quot;0&quot;</span> + Memory.readU8(p.add(i)).toString(<span class="number">16</span>).toUpperCase()).substr(-<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> session_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">arraybuffer2hexstr</span>(<span class="params">buffer</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> hexArr = <span class="built_in">Array</span>.prototype.map.call(</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(buffer),</span><br><span class="line">        <span class="function"><span class="keyword">function</span> (<span class="params">bit</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="string">&#x27;00&#x27;</span> + bit.toString(<span class="number">16</span>)).slice(-<span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> hexArr.join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 0x05 SSL_read 0xB40E38 </span></span><br><span class="line">Interceptor.attach(base.add(<span class="number">0xB40E38</span>), &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.message = <span class="string">&quot;SSL_read&quot;</span></span><br><span class="line">        <span class="built_in">this</span>.buf = args[<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;call 0xB40E38 ssl_read&#x27;</span>, args[<span class="number">2</span>])</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot; -&gt; ssl_session_id is:&quot;</span>, getSslSessionId(args[<span class="number">0</span>]))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;SSL_read ret:&quot;</span>, retval)</span><br><span class="line">        <span class="keyword">var</span> byteArray = Memory.readByteArray(<span class="built_in">this</span>.buf, <span class="built_in">parseInt</span>(retval))</span><br><span class="line">        <span class="built_in">console</span>.log(byteArray, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 0x06 SSL_write 0xB40FEC</span></span><br><span class="line">Interceptor.attach(base.add(<span class="number">0xB40FEC</span>), &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//bad command</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;call 0xB40FEC ssl_write&#x27;</span>, args[<span class="number">0</span>], args[<span class="number">2</span>])</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot; -&gt;ssl_session_id is:&quot;</span>, getSslSessionId(args[<span class="number">0</span>]))</span><br><span class="line">        <span class="keyword">var</span> byteArray = Memory.readByteArray(args[<span class="number">1</span>], <span class="built_in">parseInt</span>(args[<span class="number">2</span>]))</span><br><span class="line">        <span class="built_in">console</span>.log(byteArray)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;SSL_Write ret:&quot;</span>, retval, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<p>经过测试三种方式都是可以正常抓包的，这里贴一下抓包内容：</p>
<p><img src="./login_zoom_com.png"></p>
<p><img src="./login_zoom_us.png"></p>
<p>通过zoom.com 重定向到zoom.us，但是抓包的内容是一样的。下面我们就登陆部分做个简单分析</p>
<h2 id="0x02-登陆字段分析"><a href="#0x02-登陆字段分析" class="headerlink" title="0x02 登陆字段分析"></a>0x02 登陆字段分析</h2><p>登陆字段的计算部分都是用的C++写的，对这种无符号的代码，分析起来也没什么技巧，就是头铁。在识别加密算法的时候，由于经验不足，就直接上搜索引擎上去搜关键变量，然后结合openssl源码找特征。</p>
<p>总之能hook的就hook，不能hook的再调试分析。</p>
<p>通过捕获的数据包可以看到login相关字段如下：</p>
<ol>
<li>ZM-CID==deviceId==cid==hash_macaddress</li>
<li>Cookies ==&gt;ZM-SESS-KEY +  srid(SaaSbeeTestMode00123578)</li>
<li>password</li>
<li>ecp</li>
<li>ZM-DID</li>
</ol>
<p>在分析这些字段之前，我们还需要一个小tips，zoom中使用了自定义的string结构，姑且命名为CmmCstringT，结构大致如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"><span class="comment">// |00|01|02|03|04|05|06|07|08|09|0a|0b|0c|0d|0e|0f|</span></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"><span class="comment">//  addr Cmm::CStringT     | str or ptr2str</span></span><br><span class="line"><span class="comment">//  len                    |                    |flag</span></span><br><span class="line"></span><br><span class="line"><span class="function">QWORD *__fastcall <span class="title">Cmm_CStringT</span><span class="params">(_QWORD *a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD *v2; <span class="comment">// x20</span></span><br><span class="line"></span><br><span class="line">  v2 = a1;</span><br><span class="line">  *a1 = &amp;off_10268E010;</span><br><span class="line">  a1[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  a1[<span class="number">2</span>] = <span class="number">0LL</span>;</span><br><span class="line">  a1[<span class="number">3</span>] = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a2 )</span><br><span class="line">    std::__1::basic_string&lt;<span class="keyword">char</span>,std::__1::char_traits&lt;<span class="keyword">char</span>&gt;,std::__1::allocator&lt;<span class="keyword">char</span>&gt;&gt;::<span class="built_in">assign</span>();</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们hook这个Cmm_CStringT函数，可以得到蛮多有趣的消息。</p>
<h3 id="hash-macaddress"><a href="#hash-macaddress" class="headerlink" title="hash_macaddress"></a>hash_macaddress</h3><p>对于hash_macaddress字段直接hook 对应关键字即可分析出流程，</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __fastcall <span class="title">generateDeviceIdentifier</span><span class="params">(<span class="keyword">void</span> *bundleIdentifier)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> *v1; <span class="comment">// x19</span></span><br><span class="line">  __int64 v2; <span class="comment">// x22</span></span><br><span class="line">  <span class="keyword">char</span> *v3; <span class="comment">// x19</span></span><br><span class="line">  <span class="keyword">void</span> **v4; <span class="comment">// [xsp+10h] [xbp-150h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [xsp+18h] [xbp-148h]</span></span><br><span class="line">  __int64 (__fastcall *v6)(); <span class="comment">// [xsp+20h] [xbp-140h]</span></span><br><span class="line">  <span class="keyword">void</span> *v7; <span class="comment">// [xsp+28h] [xbp-138h]</span></span><br><span class="line">  __int64 *v8; <span class="comment">// [xsp+30h] [xbp-130h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [xsp+38h] [xbp-128h]</span></span><br><span class="line">  __int64 *v10; <span class="comment">// [xsp+40h] [xbp-120h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [xsp+48h] [xbp-118h]</span></span><br><span class="line">  <span class="keyword">void</span> *v12; <span class="comment">// [xsp+50h] [xbp-110h]</span></span><br><span class="line">  __int64 v13; <span class="comment">// [xsp+58h] [xbp-108h]</span></span><br><span class="line">  <span class="keyword">char</span> v14[<span class="number">16</span>]; <span class="comment">// [xsp+C0h] [xbp-A0h]</span></span><br><span class="line">  __int128 v15; <span class="comment">// [xsp+D0h] [xbp-90h]</span></span><br><span class="line">  __int128 v16; <span class="comment">// [xsp+E0h] [xbp-80h]</span></span><br><span class="line">  __int128 v17; <span class="comment">// [xsp+F0h] [xbp-70h]</span></span><br><span class="line">  <span class="keyword">char</span> v18; <span class="comment">// [xsp+100h] [xbp-60h]</span></span><br><span class="line">  <span class="keyword">char</span> v19[<span class="number">32</span>]; <span class="comment">// [xsp+108h] [xbp-58h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( bundleIdentifier )</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = bundleIdentifier;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">objc_msgSend</span>(bundleIdentifier, <span class="string">&quot;length&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v9 = <span class="number">0LL</span>;</span><br><span class="line">      v10 = &amp;v9;</span><br><span class="line">      v11 = <span class="number">584383987712LL</span>;</span><br><span class="line">      v12 = &amp;unk_10249643D;</span><br><span class="line">      <span class="built_in">CC_SHA256_Init</span>(&amp;v13);</span><br><span class="line">      v4 = _NSConcreteStackBlock;</span><br><span class="line">      v5 = <span class="number">0xC2000000</span>LL;</span><br><span class="line">      v6 = sub_100312B08;</span><br><span class="line">      v7 = &amp;unk_102697FC0;</span><br><span class="line">      v8 = &amp;v9;</span><br><span class="line">      <span class="built_in">objc_msgSend</span>(v1, <span class="string">&quot;enumerateByteRangesUsingBlock:&quot;</span>, &amp;v4);</span><br><span class="line">      <span class="built_in">CC_SHA256_Final</span>();</span><br><span class="line">      v2 = <span class="number">0LL</span>;</span><br><span class="line">      v18 = <span class="number">0</span>;</span><br><span class="line">      v16 = <span class="number">0u</span>;</span><br><span class="line">      v17 = <span class="number">0u</span>;</span><br><span class="line">      *(_OWORD *)v14 = <span class="number">0u</span>;</span><br><span class="line">      v15 = <span class="number">0u</span>;</span><br><span class="line">      v3 = v14;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        __sprintf_chk(v3, <span class="number">0</span>, <span class="number">0xFFFFFFFFFFFFFFFF</span>LL, <span class="string">&quot;%02x&quot;</span>, (<span class="keyword">unsigned</span> __int8)v19[v2++]);</span><br><span class="line">        v3 += <span class="number">2</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v2 != <span class="number">32</span> );</span><br><span class="line">      v18 = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">objc_msgSend</span>(&amp;OBJC_CLASS___NSString, <span class="string">&quot;stringWithUTF8String:&quot;</span>, v14);</span><br><span class="line">      _Block_object_dispose(&amp;v9, <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">----&gt; +[ZPLogHelper infoLog:withString] UIDevice getDeviceIdentifier from DB/Keychain:  a2458afb3e281029a1b9635b0e271d1301e246176b4e8710666ad4bd70866f37</span><br><span class="line">通过对base64指定结果进行栈回溯可以看到调用流程，以及加密deviceid的位置sub_1013F7BA4</span><br></pre></td></tr></table></figure>

<p>这里直接写结果：</p>
<ol>
<li><p>第一次使用app， 生成DeviceIdentifier，存入keychain/DB， 后续都直接取这个值使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一次启动app的时候，使用这种方式生成id</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_identifier</span>(<span class="params">bundleid</span>):</span></span><br><span class="line">    _<span class="built_in">str</span>=<span class="built_in">str</span>(uuid.uuid1())+bundleid</span><br><span class="line">    _out=hashlib.sha256(_<span class="built_in">str</span>.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span> (_out)</span><br><span class="line">    <span class="keyword">return</span> _out</span><br></pre></td></tr></table></figure></li>
<li><p>计算hash_macaddress 字段的值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  这个identifier 是可以直接从keychain 中读取的， 利用keychain_dumper 或 frida </span></span><br><span class="line"><span class="comment">#  从keychain 中读取64位字符的id当作字符串传入即可</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_hash_macaddress</span>(<span class="params">identifier</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(identifier, <span class="built_in">str</span>):</span><br><span class="line">        identifier = identifier.encode()</span><br><span class="line">    a=hashlib.sha256(identifier).hexdigest()</span><br><span class="line">    b=hashlib.sha256(<span class="built_in">bytes</span>.fromhex(a)).hexdigest()</span><br><span class="line">    c=hashlib.sha256(<span class="built_in">bytes</span>.fromhex(b)).hexdigest()</span><br><span class="line">    result=base64.b64encode(<span class="built_in">bytes</span>.fromhex(c))</span><br><span class="line">    <span class="built_in">print</span> (result)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="ZM-SESS-KEY"><a href="#ZM-SESS-KEY" class="headerlink" title="ZM-SESS-KEY"></a>ZM-SESS-KEY</h3><p><img src="./ZM-SESS-KEY.jpg"></p>
<p>==》读取hash_macaddress的值，将‘+’‘=’等符号转义，再拼接一个32位的随机字节数组</p>
<ol start="2">
<li>计算拼接后的内容的sha256，记作_input</li>
<li>使用内置公钥，RSA加密_input，得到密文 _encd</li>
<li>将 _encd base64编码，再拼接’,v1’，得到最终数据，用作Cookie中的ZM-SESS-KEY 字段，再拼接一些常量即可</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RSA_enc</span>():</span></span><br><span class="line">    a=compute_hash_macaddress(DEVICE_ID)</span><br><span class="line">    <span class="comment"># b=random.randbytes(32)</span></span><br><span class="line">    b = <span class="built_in">bytes</span>([random.randrange(<span class="number">0</span>, <span class="number">256</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">32</span>)])</span><br><span class="line">    _<span class="keyword">in</span>=a+b</span><br><span class="line">    <span class="comment"># print (&quot;_in:&quot;, _in, type(_in))</span></span><br><span class="line">    c=hashlib.sha256(_<span class="keyword">in</span>).hexdigest() <span class="comment"># 记住这个sha256 的值</span></span><br><span class="line">    PASSWD_KEY=c</span><br><span class="line">    <span class="built_in">print</span> (c)</span><br><span class="line">    _rsa_encd=openssl_rsa_enc(c)</span><br><span class="line">    _out=base64.b64encode(_rsa_encd)</span><br><span class="line">    _out=_out+<span class="string">b&#x27;,v1&#x27;</span></span><br><span class="line">    _out=quote(_out.decode())</span><br><span class="line">    <span class="built_in">print</span>(_out)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="password"><a href="#password" class="headerlink" title="password"></a>password</h3><p>password和ecp字段使用的方式都是一样的，取一个key来加密我们输入的password，ecp的key 是生成的一个udid。</p>
<p><img src="./ecp_passwd_ida.png"></p>
<p><img src="./sha256_aes128cbc_b64.jpg"></p>
<p>但是passwprd字段的key却让我一通好找，最终使用的方式是在进入函数分配好内存（new(0xC28uLL)) 后便对存储key的区域下内存写入断点，断下后再查看调用栈，最终明白使用的key便是计算ZM-SESS-KEY 字段时的加密数据明文。</p>
<p>==》</p>
<ol>
<li>使用计算Cookie字段中的_input 当作是AES 加密使用的key</li>
<li>将上面的key计算sha256，所得结果用作aes_key，将aes_key计算hash用作iv</li>
<li>iv长度与分块大小一致，恒为16， 使用的aes加密模式为aes_128_cbc，所以aes_key 实际上为sha256(_input)[0:16]</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AES_enc</span>(<span class="params">_key, _passwd</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(_key, <span class="built_in">str</span>):</span><br><span class="line">        _key=_key.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    _aes_key=hashlib.sha256(_key).hexdigest()</span><br><span class="line">    <span class="comment"># print (_aes_key)</span></span><br><span class="line">    _aes_iv=hashlib.sha256(<span class="built_in">bytes</span>.fromhex(_aes_key)).hexdigest()</span><br><span class="line">    <span class="comment"># print (_aes_iv)</span></span><br><span class="line">    cipher=AES.new(<span class="built_in">bytes</span>.fromhex(_aes_key)[<span class="number">0</span>:<span class="number">16</span>], AES.MODE_CBC,<span class="built_in">bytes</span>.fromhex(_aes_iv)[<span class="number">0</span>:<span class="number">16</span>])</span><br><span class="line">    x=__BLOCK_SIZE_16 - (<span class="built_in">len</span>(_passwd) % __BLOCK_SIZE_16)</span><br><span class="line">    <span class="keyword">if</span> x!=<span class="number">0</span>:</span><br><span class="line">        _passwd=_passwd+<span class="built_in">chr</span>(x)*x</span><br><span class="line">    _enc = cipher.encrypt(_passwd)</span><br><span class="line">    _out=base64.b64encode(_enc)</span><br><span class="line">    <span class="built_in">print</span>(_out)</span><br><span class="line">    <span class="keyword">return</span> _out</span><br></pre></td></tr></table></figure>



<p>看到这里，很明显的数据使用对称加密算法加密、密钥使用非对称算法加密。</p>
<p>脚本丢在<a target="_blank" rel="noopener" href="https://github.com/avcatshy/noobs/tree/main/zoom-easy-analysis">GitHub</a>上了。</p>
<h2 id="0x03-“加入会议”-功能分析"><a href="#0x03-“加入会议”-功能分析" class="headerlink" title="0x03 “加入会议” 功能分析"></a><del>0x03 “加入会议” 功能分析</del></h2><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a target="_blank" rel="noopener" href="https://frida.re/docs/javascript-api/">frida 官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://www.dllhook.com/post/51.html">LLDB常用命令–飘云整理</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cocoajin/p/6121706.html">openssl evp 对称加密(AES_ecb,ccb)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.openssl.org/docs/man1.1.1/">Openssl Doc</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html">图解SSL/TLS协议</a></li>
<li><a target="_blank" rel="noopener" href="https://www.linuxidc.com/Linux/2016-05/131147.htm">SSL/TLS原理详解</a></li>
<li><a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc7627">Transport Layer Security (TLS) Session Hash andExtended Master Secret Extension</a></li>
<li><a target="_blank" rel="noopener" href="https://cshihong.github.io/2019/05/09/SSL%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/">SSL/TLS协议详解</a></li>
<li><a target="_blank" rel="noopener" href="http://www.zedwood.com/article/c-libssl-verify-x509-certificate">C++ OpenSSL Verify X509 Certificate</a></li>
<li><a target="_blank" rel="noopener" href="http://scz.617.cn:8/misc/201905081756.txt">IoT设备逆向工程中的函数识别</a></li>
</ol>
</div><div class="article-licensing box"><div class="licensing-title"><p>Zoom 简单分析</p><p><a href="https://avcatshy.github.io/2021/07/03/Zoom-简单分析/">https://avcatshy.github.io/2021/07/03/Zoom-简单分析/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>vlinkstone</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-07-03</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-07-03</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/iOS/">iOS</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/07/03/cve-2019-6788-note/"><span class="level-item">cve-2019-6788 Note</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://avcatshy.github.io/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/';
            this.page.identifier = '2021/07/03/Zoom-简单分析/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'vlinkstone' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="vlinkstone"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">vlinkstone</p><p class="is-size-6 is-block">Security Noobs</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>CN</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">6</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="mailto:vlinkstone@gmail.com" target="_blank" rel="noopener">联系我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/avcatshy"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/avcatshy"><i class="fab fa-twitter"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://jdkhnjggf.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Iuobobo</span></span><span class="level-right"><span class="level-item tag">jdkhnjggf.github.io</span></span></a></li><li><a class="level is-mobile" href="https://www.zuozuovera.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">薇拉航线🌺</span></span><span class="level-right"><span class="level-item tag">www.zuozuovera.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/BIN/"><span class="level-start"><span class="level-item">BIN</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/QEMU/"><span class="level-start"><span class="level-item">QEMU</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/iOS/"><span class="level-start"><span class="level-item">iOS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-03T15:43:18.545Z">2021-07-03</time></p><p class="title"><a href="/2021/07/03/Zoom-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/">Zoom 简单分析</a></p><p class="categories"><a href="/categories/iOS/">iOS</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-03T13:37:55.110Z">2021-07-03</time></p><p class="title"><a href="/2021/07/03/cve-2019-6788-note/">cve-2019-6788 Note</a></p><p class="categories"><a href="/categories/QEMU/">QEMU</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-12-28T06:20:17.825Z">2020-12-27</time></p><p class="title"><a href="/2020/12/27/%E5%B0%8F%E8%AE%B0%E4%B8%80%E5%88%99%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84Fastbin%E5%88%A9%E7%94%A8/">小记一则不一样的Fastbin利用</a></p><p class="categories"><a href="/categories/BIN/">BIN</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-12-28T06:20:07.377Z">2020-12-27</time></p><p class="title"><a href="/2020/12/27/glibc%E5%88%A9%E7%94%A8%E4%B9%8BFastbinDup/">glibc 利用之Fastbin Dup</a></p><p class="categories"><a href="/categories/BIN/">BIN</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-02-02T08:00:00.000Z">2020-02-02</time></p><p class="title"><a href="/2020/02/02/about/">about</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">十二月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Bin/"><span class="tag">Bin</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NETGEAR/"><span class="tag">NETGEAR</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/QEMU/"><span class="tag">QEMU</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Router/"><span class="tag">Router</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Security/"><span class="tag">Security</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://avatars.githubusercontent.com/u/20829507?s=60&amp;v=4" alt="avcatshy" height="28"></a><p class="is-size-7"><span>&copy; 2021 vlinkstone</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><!--!--></body></html>